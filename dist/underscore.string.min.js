//  underscore.string//  (c) 2012 Esa-Matti Suuronen <esa-matti aet suuronen dot org>
//  Underscore.string is freely distributable under the terms of the MIT license.
//  Documentation http://epeli.github.com/underscore.string/
//  Some code is borrowed from MooTools and Alexandru Marasteanu.
//  Version 2.3.0
!function(e,t){"use strict";var n=t.prototype.trim,r=t.prototype.trimRight,i=t.prototype.trimLeft,s=function(){return arguments[arguments.length-1].toUpperCase()},o=[].slice,u=function(e){return e==null?"\\s":e.source?e.source:"["+p.escapeRegExp(e)+"]"},a=function(e,t){if(t<1)return"";var n="";while(t>0)t&1&&(n+=e),t>>=1,e+=e;return n},f={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},l={};for(var c in f)l[f[c]]=c;var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=a,r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,i){var s=1,o=r.length,u="",a,f=[],l,c,p,d,v,m;for(l=0;l<o;l++){u=e(r[l]);if(u==="string")f.push(r[l]);else if(u==="array"){p=r[l];if(p[2]){a=i[s];for(c=0;c<p[2].length;c++){if(!a.hasOwnProperty(p[2][c]))throw new Error(h('[_.sprintf] property "%s" does not exist',p[2][c]));a=a[p[2][c]]}}else p[1]?a=i[p[1]]:a=i[s++];if(/[^s]/.test(p[8])&&e(a)!="number")throw new Error(h("[_.sprintf] expecting number but found %s",e(a)));switch(p[8]){case"b":a=a.toString(2);break;case"c":a=t.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=p[7]?a.toExponential(p[7]):a.toExponential();break;case"f":a=p[7]?parseFloat(a).toFixed(p[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=t(a))&&p[7]?a.substring(0,p[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(p[8])&&p[3]&&a>=0?"+"+a:a,v=p[4]?p[4]=="0"?"0":p[4].charAt(1):" ",m=p[6]-t(a).length,d=p[6]?n(v,m):"",f.push(p[5]?a+d:d+a)}}return f.join("")},r.cache={},r.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r},r}(),p={VERSION:"3.0.0"};p.isBlank=function(e){return e==null&&(e=""),/^\s*$/.test(e)},p.stripTags=function(e){return e==null?"":t(e).replace(/<\/?[^>]+>/g,"")},p.capitalize=function(e){return e=e==null?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},p.chop=function(e,n){return e==null?[]:(e=t(e),n=~~n,n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e])},p.clean=function(e){return p.strip(e).replace(/\s+/g," ")},p.count=function(e,n){if(e==null||n==null)return 0;e=t(e),n=t(n);var r=0,i=0,s=n.length;for(;;){i=e.indexOf(n,i);if(i===-1)break;r++,i+=s}return r},p.chars=function(e){return e==null?[]:t(e).split("")},p.swapCase=function(e){return e==null?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},p.escapeHTML=function(e){return e==null?"":t(e).replace(/[&<>"']/g,function(e){return"&"+(e==="'"?"#39":l[e])+";"})},p.unescapeHTML=function(e){return e==null?"":t(e).replace(/\&([^;]+);/g,function(e,n){var r;return n in f?f[n]:(r=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(r[1],16)):(r=n.match(/^#(\d+)$/))?t.fromCharCode(~~r[1]):e})},p.escapeRegExp=function(e){return e==null?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},p.splice=function(e,t,n,r){var i=p.chars(e);return i.splice(~~t,~~n,r),i.join("")},p.insert=function(e,t,n){return p.splice(e,t,0,n)},p.include=function(e,n){return n===""?!0:e==null?!1:t(e).indexOf(n)!==-1},p.join=function(e){return e==null&&(e=""),o.call(arguments,1).join(e)},p.lines=function(e){return e==null?[]:t(e).split("\n")},p.reverse=function(e){return p.chars(e).reverse().join("")},p.startsWith=function(e,n){return n===""?!0:e==null||n==null?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(0,n.length)===n)},p.endsWith=function(e,n){return n===""?!0:e==null||n==null?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(e.length-n.length)===n)},p.succ=function(e){return e==null?"":t(e).replace(/.$/,function(e){return t.fromCharCode(e.charCodeAt(0)+1)})},p.titleize=function(e){return e==null?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},p.camelize=function(e){return p.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},p.underscored=function(e){return p.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},p.dasherize=function(e){return p.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},p.classify=function(e){return e==null?"":p.titleize(t(e).replace(/[\W_]/g," ")).replace(/\s/g,"")},p.humanize=function(e){return p.capitalize(p.underscored(e).replace(/_id$/,"").replace(/_/g," "))},p.trim=function(e,r){return e==null?"":!r&&n?n.call(e):(r=u(r),t(e).replace(new RegExp("^"+r+"+|"+r+"+$","g"),""))},p.ltrim=function(e,n){return e==null?"":!n&&i?i.call(e):t(e).replace(new RegExp("^"+u(n)+"+"),"")},p.rtrim=function(e,n){return e==null?"":!n&&r?r.call(e):t(e).replace(new RegExp(u(n)+"+$"),"")},p.truncate=function(e,n,r){return e==null?"":(e=t(e),r=r||"...",n=~~n,e.length>n?e.slice(0,n)+r:e)},p.prune=function(e,n,r){if(e==null)return"";e=t(e),n=~~n,r=r!=null?t(r):"...";if(e.length<=n)return e;var i=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,i);return s.slice(s.length-2).match(/\w\w/)?s=s.replace(/\s*\S+$/,""):s=p.rtrim(s.slice(0,s.length-1)),(s+r).length>e.length?e:e.slice(0,s.length)+r},p.words=function(e,t){return p.isBlank(e)?[]:p.trim(e,t).split(t||/\s+/)},p.pad=function(e,n,r,i){e=e==null?"":t(e),n=~~n;var s=0;r==null?r=" ":r=t(r),r.length>1&&(r=r.charAt(0));switch(i){case"right":return s=n-e.length,e+a(r,s);case"both":return s=n-e.length,a(r,Math.ceil(s/2))+e+a(r,Math.floor(s/2));default:return s=n-e.length,a(r,s)+e}},p.lpad=function(e,t,n){return p.pad(e,t,n)},p.rpad=function(e,t,n){return p.pad(e,t,n,"right")},p.lrpad=function(e,t,n){return p.pad(e,t,n,"both")},p.sprintf=h,p.vsprintf=function(e,t){return h.apply(null,[e].concat(t))},p.toNumber=function(e,n){return e?(e=t(e),Number(Number(e).toFixed(~~n))):0},p.numberFormat=function(e,t,n,r){if(e==null)return"";e=Number(e);if(isNaN(e))return"";r==null&&(r=","),n==null&&(n="."),e=e.toFixed(~~t);var i=e.split("."),s=i[0],o=i[1]?n+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o},p.strRight=function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},p.strRightBack=function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.lastIndexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},p.strLeft=function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(0,r):e},p.strLeftBack=function(e,t){if(e==null)return"";e+="",t=t!=null?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},p.toSentence=function(e,t,n,r){t=t||", ",n=n||" and ";var i=e.slice(),s=i.pop();return e.length>2&&r&&(n=p.rtrim(t)+n),i.length?i.join(t)+n+s:s},p.toSentenceSerial=function(){var e=o.call(arguments);return e[3]=!0,p.toSentence.apply(p,e)},p.slugify=function(e){if(e==null)return"";var n="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",r="aaaaaaaaceeeeeiiiilnoooooouuuunczz",i=new RegExp(u(n),"g");return e=t(e).toLowerCase().replace(i,function(e){var t=n.indexOf(e);return r.charAt(t)||"-"}),p.dasherize(e.replace(/[^\w\s-]/g,""))},p.surround=function(e,t){return[t,e,t].join("")},p.quote=function(e){return p.surround(e,'"')},p.repeat=function(e,n,r){if(e==null)return"";n=~~n;if(r==null)return a(t(e),n);for(var i=[];n>0;i[--n]=e);return i.join(r)},p.levenshtein=function(e,n){if(e==null&&n==null)return 0;if(e==null)return t(n).length;if(n==null)return t(e).length;e=t(e),n=t(n);var r=[],i,s;for(var o=0;o<=n.length;o++)for(var u=0;u<=e.length;u++)o&&u?e.charAt(u-1)===n.charAt(o-1)?s=i:s=Math.min(r[u],r[u-1],i)+1:s=o+u,i=r[u],r[u]=s;return r.pop()},p.strip=p.trim,p.lstrip=p.ltrim,p.rstrip=p.rtrim,p.center=p.lrpad,p.rjust=p.lpad,p.ljust=p.rpad,p.includes=p.include,p.contains=p.include,p.q=p.quote;var d=function(e){if(!e)return{str:p};var t=function(t){return t==null||e.isString(t)||e.isNumber(t)},n=e.omit(p,"include","contains","reverse","splice");return e.mixin(n),e.mixin(e.reduce(["include","contains"],function(n,r){var i=p[r],s=e[r];return n[r]=function(e){var n=t(e)?i:s;return n.apply(this,arguments)},n},{})),e.each(["reverse","splice"],function(n){var r=p[n],i=e.prototype[n],s={};s[n]=r,e.mixin(s);var o=e.prototype[n];e.prototype[n]=function(){var e=t(this._wrapped)?o:i;return e.apply(this,arguments)}}),e.str=e.string=p,e};e._=d(e._),p.integrate=d,typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(module.exports=p),exports._s=p),typeof define=="function"&&define.amd&&define("underscore.string",[],function(){return p})}(this,String);